{"ast":null,"code":"var _jsxFileName = \"E:\\\\KTCity\\\\react-course-project\\\\react-monkey-blogging\\\\src\\\\module\\\\post\\\\PostManage.js\",\n    _s = $RefreshSig$();\n\nimport Swal from \"sweetalert2\";\nimport React, { useState } from \"react\";\nimport DashboardHeading from \"module/dashboard/DashboardHeading\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useEffect } from \"react\";\nimport { Table } from \"components/table\";\nimport { postStatus } from \"utils/constants\";\nimport { LabelStatus } from \"components/label\";\nimport { Dropdown } from \"components/dropdown\";\nimport { debounce } from \"lodash\";\nimport { db } from \"firebase-app/firebase-config\";\nimport { Button } from \"components/button\";\nimport { ActionDelete, ActionEdit, ActionView } from \"components/action\";\nimport { collection, deleteDoc, doc, getDocs, limit, onSnapshot, query, startAfter, where } from \"firebase/firestore\";\nimport { useAuth } from \"contexts/auth-context\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst POST_PER_PAGE = 10;\n\nconst PostManage = () => {\n  _s();\n\n  const [postList, setPostList] = useState([]);\n  const [filter, setFilter] = useState(\"\");\n  const [lastDoc, setLastDoc] = useState();\n  const [total, setTotal] = useState(0);\n  const navigate = useNavigate();\n  useEffect(() => {\n    async function fetchData() {\n      const colRef = collection(db, \"posts\");\n      const newRef = filter ? query(colRef, where(\"title\", \">=\", filter), where(\"title\", \"<=\", filter + \"utf8\")) : query(colRef, limit(POST_PER_PAGE));\n      const documentSnapshots = await getDocs(newRef);\n      const lastVisible = documentSnapshots.docs[documentSnapshots.docs.length - 1];\n      onSnapshot(colRef, snapshot => {\n        setTotal(snapshot.size);\n      });\n      onSnapshot(newRef, snapshot => {\n        let results = [];\n        snapshot.forEach(doc => {\n          results.push({\n            id: doc.id,\n            ...doc.data()\n          });\n        });\n        setPostList(results);\n      });\n      setLastDoc(lastVisible);\n    }\n\n    fetchData();\n  }, [filter]);\n\n  const handleDeletePost = async postId => {\n    const docRef = doc(db, \"posts\", postId);\n    Swal.fire({\n      title: \"Are you sure?\",\n      text: \"You won't be able to revert this!\",\n      icon: \"warning\",\n      showCancelButton: true,\n      confirmButtonColor: \"#3085d6\",\n      cancelButtonColor: \"#d33\",\n      confirmButtonText: \"Yes, delete it!\"\n    }).then(async result => {\n      if (result.isConfirmed) {\n        await deleteDoc(docRef);\n        Swal.fire(\"Deleted!\", \"Your post has been deleted.\", \"success\");\n      }\n    });\n  };\n\n  const renderPostStatus = status => {\n    switch (status) {\n      case postStatus.APPROVED:\n        return /*#__PURE__*/_jsxDEV(LabelStatus, {\n          type: \"success\",\n          children: \"Approve\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 16\n        }, this);\n\n      case postStatus.PENDING:\n        return /*#__PURE__*/_jsxDEV(LabelStatus, {\n          type: \"warning\",\n          children: \"Pending\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 16\n        }, this);\n\n      case postStatus.REJECTED:\n        return /*#__PURE__*/_jsxDEV(LabelStatus, {\n          type: \"danger\",\n          children: \"Rejected\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 16\n        }, this);\n\n      default:\n        break;\n    }\n  };\n\n  const handleSearchPost = debounce(e => {\n    setFilter(e.target.value);\n  }, 250);\n\n  const handleLoadMorePost = async () => {\n    const nextRef = query(collection(db, \"posts\"), startAfter(lastDoc || 0), limit(POST_PER_PAGE));\n    onSnapshot(nextRef, snapshot => {\n      let results = [];\n      snapshot.forEach(doc => {\n        results.push({\n          id: doc.id,\n          ...doc.data()\n        });\n      });\n      setPostList([...postList, ...results]);\n    });\n    const documentSnapshots = await getDocs(nextRef);\n    const lastVisible = documentSnapshots.docs[documentSnapshots.docs.length - 1];\n    setLastDoc(lastVisible);\n  };\n\n  const {\n    userInfo\n  } = useAuth();\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(DashboardHeading, {\n      title: \"All posts\",\n      desc: \"Manage all posts\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mb-10 flex justify-end gap-5\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-full max-w-[200px]\",\n        children: /*#__PURE__*/_jsxDEV(Dropdown, {\n          children: /*#__PURE__*/_jsxDEV(Dropdown.Select, {\n            placeholder: \"Category\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 127,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-full max-w-[300px]\",\n        children: /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          className: \"w-full p-4 rounded-lg border border-solid border-gray-300\",\n          placeholder: \"Search post...\",\n          onChange: handleSearchPost\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Table, {\n      children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n        children: /*#__PURE__*/_jsxDEV(\"tr\", {\n          children: [/*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"Id\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 142,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"Post\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 143,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"Category\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 144,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"Author\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 145,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"Status\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 146,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n            children: \"Actions\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 147,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n        children: postList.length > 0 && postList.map(post => {\n          var _post$createdAt, _post$createdAt2, _post$createdAt3, _post$id, _post$category, _post$user;\n\n          const date = post !== null && post !== void 0 && (_post$createdAt = post.createdAt) !== null && _post$createdAt !== void 0 && _post$createdAt.seconds ? new Date((post === null || post === void 0 ? void 0 : (_post$createdAt2 = post.createdAt) === null || _post$createdAt2 === void 0 ? void 0 : _post$createdAt2.seconds) * 1000) : new Date();\n          const formatDate = new Date(date).toLocaleDateString(\"vi-VI\");\n          console.log(new Date((post === null || post === void 0 ? void 0 : (_post$createdAt3 = post.createdAt) === null || _post$createdAt3 === void 0 ? void 0 : _post$createdAt3.seonds) * 1000));\n          return /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"td\", {\n              children: ((_post$id = post.id) === null || _post$id === void 0 ? void 0 : _post$id.slice(0, 5)) + \"...\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 160,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center gap-x-3\",\n                children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                  src: post.image,\n                  alt: \"\",\n                  className: \"w-[66px] h-[55px] rounded object-cover\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 163,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"flex-1\",\n                  children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n                    className: \"font-semibold max-w-[300px] whitespace-pre-wrap\",\n                    children: post.title\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 169,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(\"time\", {\n                    className: \"text-sm text-gray-500\",\n                    children: [\"Date: \", formatDate]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 172,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 168,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 162,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 161,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-gray-500\",\n                children: (_post$category = post.category) === null || _post$category === void 0 ? void 0 : _post$category.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 179,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 178,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"text-gray-500\",\n                children: (_post$user = post.user) === null || _post$user === void 0 ? void 0 : _post$user.username\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 182,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 181,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: renderPostStatus(post.status)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 184,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"flex items-center gap-x-3 text-gray-500\",\n                children: [/*#__PURE__*/_jsxDEV(ActionView, {\n                  onClick: () => navigate(`/${post.slug}`)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 187,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(ActionEdit, {\n                  onClick: () => navigate(`/manage/update-post?id=${post.id}`)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 190,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(ActionDelete, {\n                  onClick: () => handleDeletePost(post.id)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 195,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 186,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 185,\n              columnNumber: 19\n            }, this)]\n          }, post.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 159,\n            columnNumber: 17\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 7\n    }, this), total > postList.length && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-10 text-center\",\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        className: \"mx-auto w-[200px]\",\n        onClick: handleLoadMorePost,\n        children: \"See more+\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 119,\n    columnNumber: 5\n  }, this);\n};\n\n_s(PostManage, \"sQcF94wYsfja0Oxgw+A7torK0Zc=\", false, function () {\n  return [useNavigate, useAuth];\n});\n\n_c = PostManage;\nexport default PostManage;\n\nvar _c;\n\n$RefreshReg$(_c, \"PostManage\");","map":{"version":3,"sources":["E:/KTCity/react-course-project/react-monkey-blogging/src/module/post/PostManage.js"],"names":["Swal","React","useState","DashboardHeading","useNavigate","useEffect","Table","postStatus","LabelStatus","Dropdown","debounce","db","Button","ActionDelete","ActionEdit","ActionView","collection","deleteDoc","doc","getDocs","limit","onSnapshot","query","startAfter","where","useAuth","POST_PER_PAGE","PostManage","postList","setPostList","filter","setFilter","lastDoc","setLastDoc","total","setTotal","navigate","fetchData","colRef","newRef","documentSnapshots","lastVisible","docs","length","snapshot","size","results","forEach","push","id","data","handleDeletePost","postId","docRef","fire","title","text","icon","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","then","result","isConfirmed","renderPostStatus","status","APPROVED","PENDING","REJECTED","handleSearchPost","e","target","value","handleLoadMorePost","nextRef","userInfo","map","post","date","createdAt","seconds","Date","formatDate","toLocaleDateString","console","log","seonds","slice","image","category","name","user","username","slug"],"mappings":"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","sourcesContent":["import Swal from \"sweetalert2\";\nimport React, { useState } from \"react\";\nimport DashboardHeading from \"module/dashboard/DashboardHeading\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useEffect } from \"react\";\nimport { Table } from \"components/table\";\nimport { postStatus } from \"utils/constants\";\nimport { LabelStatus } from \"components/label\";\nimport { Dropdown } from \"components/dropdown\";\nimport { debounce } from \"lodash\";\nimport { db } from \"firebase-app/firebase-config\";\nimport { Button } from \"components/button\";\nimport { ActionDelete, ActionEdit, ActionView } from \"components/action\";\nimport {\n  collection,\n  deleteDoc,\n  doc,\n  getDocs,\n  limit,\n  onSnapshot,\n  query,\n  startAfter,\n  where,\n} from \"firebase/firestore\";\nimport { useAuth } from \"contexts/auth-context\";\nconst POST_PER_PAGE = 10;\nconst PostManage = () => {\n  const [postList, setPostList] = useState([]);\n  const [filter, setFilter] = useState(\"\");\n  const [lastDoc, setLastDoc] = useState();\n  const [total, setTotal] = useState(0);\n  const navigate = useNavigate();\n  useEffect(() => {\n    async function fetchData() {\n      const colRef = collection(db, \"posts\");\n      const newRef = filter\n        ? query(\n            colRef,\n            where(\"title\", \">=\", filter),\n            where(\"title\", \"<=\", filter + \"utf8\")\n          )\n        : query(colRef, limit(POST_PER_PAGE));\n      const documentSnapshots = await getDocs(newRef);\n      const lastVisible =\n        documentSnapshots.docs[documentSnapshots.docs.length - 1];\n      onSnapshot(colRef, (snapshot) => {\n        setTotal(snapshot.size);\n      });\n      onSnapshot(newRef, (snapshot) => {\n        let results = [];\n        snapshot.forEach((doc) => {\n          results.push({\n            id: doc.id,\n            ...doc.data(),\n          });\n        });\n        setPostList(results);\n      });\n      setLastDoc(lastVisible);\n    }\n    fetchData();\n  }, [filter]);\n  const handleDeletePost = async (postId) => {\n    const docRef = doc(db, \"posts\", postId);\n    Swal.fire({\n      title: \"Are you sure?\",\n      text: \"You won't be able to revert this!\",\n      icon: \"warning\",\n      showCancelButton: true,\n      confirmButtonColor: \"#3085d6\",\n      cancelButtonColor: \"#d33\",\n      confirmButtonText: \"Yes, delete it!\",\n    }).then(async (result) => {\n      if (result.isConfirmed) {\n        await deleteDoc(docRef);\n        Swal.fire(\"Deleted!\", \"Your post has been deleted.\", \"success\");\n      }\n    });\n  };\n  const renderPostStatus = (status) => {\n    switch (status) {\n      case postStatus.APPROVED:\n        return <LabelStatus type=\"success\">Approve</LabelStatus>;\n      case postStatus.PENDING:\n        return <LabelStatus type=\"warning\">Pending</LabelStatus>;\n      case postStatus.REJECTED:\n        return <LabelStatus type=\"danger\">Rejected</LabelStatus>;\n      default:\n        break;\n    }\n  };\n  const handleSearchPost = debounce((e) => {\n    setFilter(e.target.value);\n  }, 250);\n  const handleLoadMorePost = async () => {\n    const nextRef = query(\n      collection(db, \"posts\"),\n      startAfter(lastDoc || 0),\n      limit(POST_PER_PAGE)\n    );\n\n    onSnapshot(nextRef, (snapshot) => {\n      let results = [];\n      snapshot.forEach((doc) => {\n        results.push({\n          id: doc.id,\n          ...doc.data(),\n        });\n      });\n      setPostList([...postList, ...results]);\n    });\n    const documentSnapshots = await getDocs(nextRef);\n    const lastVisible =\n      documentSnapshots.docs[documentSnapshots.docs.length - 1];\n    setLastDoc(lastVisible);\n  };\n  const { userInfo } = useAuth();\n  return (\n    <div>\n      <DashboardHeading\n        title=\"All posts\"\n        desc=\"Manage all posts\"\n      ></DashboardHeading>\n      <div className=\"mb-10 flex justify-end gap-5\">\n        <div className=\"w-full max-w-[200px]\">\n          <Dropdown>\n            <Dropdown.Select placeholder=\"Category\"></Dropdown.Select>\n          </Dropdown>\n        </div>\n        <div className=\"w-full max-w-[300px]\">\n          <input\n            type=\"text\"\n            className=\"w-full p-4 rounded-lg border border-solid border-gray-300\"\n            placeholder=\"Search post...\"\n            onChange={handleSearchPost}\n          />\n        </div>\n      </div>\n      <Table>\n        <thead>\n          <tr>\n            <th>Id</th>\n            <th>Post</th>\n            <th>Category</th>\n            <th>Author</th>\n            <th>Status</th>\n            <th>Actions</th>\n          </tr>\n        </thead>\n        <tbody>\n          {postList.length > 0 &&\n            postList.map((post) => {\n              const date = post?.createdAt?.seconds\n                ? new Date(post?.createdAt?.seconds * 1000)\n                : new Date();\n              const formatDate = new Date(date).toLocaleDateString(\"vi-VI\");\n              console.log(new Date(post?.createdAt?.seonds * 1000));\n              return (\n                <tr key={post.id}>\n                  <td>{post.id?.slice(0, 5) + \"...\"}</td>\n                  <td>\n                    <div className=\"flex items-center gap-x-3\">\n                      <img\n                        src={post.image}\n                        alt=\"\"\n                        className=\"w-[66px] h-[55px] rounded object-cover\"\n                      />\n                      <div className=\"flex-1\">\n                        <h3 className=\"font-semibold max-w-[300px] whitespace-pre-wrap\">\n                          {post.title}\n                        </h3>\n                        <time className=\"text-sm text-gray-500\">\n                          Date: {formatDate}\n                        </time>\n                      </div>\n                    </div>\n                  </td>\n                  <td>\n                    <span className=\"text-gray-500\">{post.category?.name}</span>\n                  </td>\n                  <td>\n                    <span className=\"text-gray-500\">{post.user?.username}</span>\n                  </td>\n                  <td>{renderPostStatus(post.status)}</td>\n                  <td>\n                    <div className=\"flex items-center gap-x-3 text-gray-500\">\n                      <ActionView\n                        onClick={() => navigate(`/${post.slug}`)}\n                      ></ActionView>\n                      <ActionEdit\n                        onClick={() =>\n                          navigate(`/manage/update-post?id=${post.id}`)\n                        }\n                      ></ActionEdit>\n                      <ActionDelete\n                        onClick={() => handleDeletePost(post.id)}\n                      ></ActionDelete>\n                    </div>\n                  </td>\n                </tr>\n              );\n            })}\n        </tbody>\n      </Table>\n      {total > postList.length && (\n        <div className=\"mt-10 text-center\">\n          <Button className=\"mx-auto w-[200px]\" onClick={handleLoadMorePost}>\n            See more+\n          </Button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default PostManage;\n"]},"metadata":{},"sourceType":"module"}