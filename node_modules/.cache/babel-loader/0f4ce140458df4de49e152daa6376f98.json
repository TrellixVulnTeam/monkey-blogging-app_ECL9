{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useAuth } from \"contexts/auth-context\";\nimport { deleteObject, getDownloadURL, getStorage, ref, uploadBytesResumable } from \"firebase/storage\";\nimport { useState } from \"react\";\nimport Swal from \"sweetalert2\";\nimport { userRole } from \"utils/constants\";\nexport default function useFirebaseImage(setValue, getValues) {\n  _s();\n\n  let imageName = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  let cb = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n  const {\n    userInfo\n  } = useAuth();\n  const [progress, setProgress] = useState(0);\n  const [image, setImage] = useState(\"\");\n  if (!setValue || !getValues) return;\n\n  const handleUploadImage = file => {\n    const storage = getStorage();\n    const storageRef = ref(storage, \"images/\" + file.name);\n    const uploadTask = uploadBytesResumable(storageRef, file);\n    uploadTask.on(\"state_changed\", snapshot => {\n      const progressPercent = snapshot.bytesTransferred / snapshot.totalBytes * 100;\n      setProgress(progressPercent);\n\n      switch (snapshot.state) {\n        case \"paused\":\n          console.log(\"Upload is paused\");\n          break;\n\n        case \"running\":\n          console.log(\"Upload is running\");\n          break;\n\n        default:\n          console.log(\"Nothing at all\");\n      }\n    }, error => {\n      console.log(\"Error\");\n      setImage(\"\");\n    }, () => {\n      getDownloadURL(uploadTask.snapshot.ref).then(downloadURL => {\n        console.log(\"File available at\", downloadURL);\n        setImage(downloadURL);\n      });\n    });\n  };\n\n  const handleSelectImage = e => {\n    const file = e.target.files[0];\n    if (!file) return;\n    setValue(\"image_name\", file.name);\n    handleUploadImage(file);\n  };\n\n  const handleDeleteImage = () => {\n    const storage = getStorage();\n    const imageRef = ref(storage, \"images/\" + (imageName || getValues(\"image_name\")));\n    deleteObject(imageRef).then(() => {\n      console.log(\"Remove image successfully\");\n      setImage(\"\");\n      setProgress(0);\n      cb && cb();\n    }).catch(error => {\n      console.log(\"handleDeleteImage ~ error\", error);\n      console.log(\"Can not delete image\");\n      setImage(\"\");\n    });\n  };\n\n  const handleResetUpload = () => {\n    setImage(\"\");\n    setProgress(0);\n  };\n\n  return {\n    image,\n    setImage,\n    handleResetUpload,\n    progress,\n    handleSelectImage,\n    handleDeleteImage\n  };\n}\n\n_s(useFirebaseImage, \"iyUBdk3KNdpF/Wb4dUQBqkJjFkY=\", false, function () {\n  return [useAuth];\n});","map":{"version":3,"sources":["E:/KTCity/react-course-project/react-monkey-blogging/src/hooks/useFirebaseImage.js"],"names":["useAuth","deleteObject","getDownloadURL","getStorage","ref","uploadBytesResumable","useState","Swal","userRole","useFirebaseImage","setValue","getValues","imageName","cb","userInfo","progress","setProgress","image","setImage","handleUploadImage","file","storage","storageRef","name","uploadTask","on","snapshot","progressPercent","bytesTransferred","totalBytes","state","console","log","error","then","downloadURL","handleSelectImage","e","target","files","handleDeleteImage","imageRef","catch","handleResetUpload"],"mappings":"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","sourcesContent":["import { useAuth } from \"contexts/auth-context\";\nimport {\n  deleteObject,\n  getDownloadURL,\n  getStorage,\n  ref,\n  uploadBytesResumable,\n} from \"firebase/storage\";\nimport { useState } from \"react\";\nimport Swal from \"sweetalert2\";\nimport { userRole } from \"utils/constants\";\n\nexport default function useFirebaseImage(\n  setValue,\n  getValues,\n  imageName = null,\n  cb = null\n) {\n  const { userInfo } = useAuth();\n  const [progress, setProgress] = useState(0);\n  const [image, setImage] = useState(\"\");\n  if (!setValue || !getValues) return;\n  const handleUploadImage = (file) => {\n    const storage = getStorage();\n    const storageRef = ref(storage, \"images/\" + file.name);\n    const uploadTask = uploadBytesResumable(storageRef, file);\n    uploadTask.on(\n      \"state_changed\",\n      (snapshot) => {\n        const progressPercent =\n          (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\n        setProgress(progressPercent);\n        switch (snapshot.state) {\n          case \"paused\":\n            console.log(\"Upload is paused\");\n            break;\n          case \"running\":\n            console.log(\"Upload is running\");\n            break;\n          default:\n            console.log(\"Nothing at all\");\n        }\n      },\n      (error) => {\n        console.log(\"Error\");\n        setImage(\"\");\n      },\n      () => {\n        getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {\n          console.log(\"File available at\", downloadURL);\n          setImage(downloadURL);\n        });\n      }\n    );\n  };\n  const handleSelectImage = (e) => {\n    const file = e.target.files[0];\n    if (!file) return;\n    setValue(\"image_name\", file.name);\n    handleUploadImage(file);\n  };\n\n  const handleDeleteImage = () => {\n    const storage = getStorage();\n    const imageRef = ref(\n      storage,\n      \"images/\" + (imageName || getValues(\"image_name\"))\n    );\n    deleteObject(imageRef)\n      .then(() => {\n        console.log(\"Remove image successfully\");\n        setImage(\"\");\n        setProgress(0);\n        cb && cb();\n      })\n      .catch((error) => {\n        console.log(\"handleDeleteImage ~ error\", error);\n        console.log(\"Can not delete image\");\n        setImage(\"\");\n      });\n  };\n  const handleResetUpload = () => {\n    setImage(\"\");\n    setProgress(0);\n  };\n  return {\n    image,\n    setImage,\n    handleResetUpload,\n    progress,\n    handleSelectImage,\n    handleDeleteImage,\n  };\n}\n"]},"metadata":{},"sourceType":"module"}